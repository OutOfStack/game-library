kind: ConfigMap
apiVersion: v1
metadata:
    name: game-library-config
    namespace: game-library
data:
    GIN_MODE: release
    APP_ADDRESS: 0.0.0.0:8000
    DEBUG_ADDRESS: 0.0.0.0:6060
    APP_ALLOWEDCORSORIGIN: https://vmi644117.contaboserver.net
    AUTH_VERIFYTOKENURL: https://vmi644117.contaboserver.net/_auth/token/verify
    ZIPKIN_REPORTERURL: http://vmi644117.contaboserver.net/_zipkin/api/v2/spans
---
kind: Service
apiVersion: v1
metadata:
    name: game-library-service
    namespace: game-library
spec:
    ports:
      - protocol: TCP
        name: api
        port: 8000
        targetPort: api
      - protocol: TCP
        name: debug
        port: 6060
        targetPort: debug
      - protocol: TCP
        name: zipkin
        port: 9411
        targetPort: zipkin
    selector:
        app: game-library
---
kind: Ingress
apiVersion: networking.k8s.io/v1
metadata:
    name: game-library-ingress
    namespace: game-library
    annotations:
        ingressclass.kubernetes.io/is-default-class: 'true'
        nginx.ingress.kubernetes.io/rewrite-target: /$2
        nginx.ingress.kubernetes.io/proxy-connect-timeout: "30"
        nginx.ingress.kubernetes.io/proxy-send-timeout: "600"
        nginx.ingress.kubernetes.io/proxy-read-timeout: "600"
spec:
    rules:
      - host: vmi644117.contaboserver.net
        http:
            paths:
              - path: /_api(/|$)(.*)
                pathType: Prefix
                backend:
                    service:
                        name: game-library-service
                        port:
                            number: 8000
              - path: /_debug/api(/|$)(.*)
                pathType: Prefix
                backend:
                    service:
                        name: game-library-service
                        port:
                            number: 6060
              - path: /_zipkin(/|$)(.*)
                pathType: Prefix
                backend:
                    service:
                        name: game-library-service
                        port:
                            number: 9411